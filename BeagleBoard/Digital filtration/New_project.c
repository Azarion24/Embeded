#include <stdio.h>
#include <ti/sysbios/BIOS.h>
#include <xdc/cfg/global.h>
#include <math.h>
#include "codec/codec_v1_0.c"
#include "fft/DSPF_sp_cfftr2_dit.c"
#include "fft/DSPF_sp_cfftr2_dit.h"
#include "tmwtypes.h"

#define N 2048
#define Nmaska 2047

float x[N];
int n;
float suma;
int i, probka;

int BL = 100;
float B[100] = {
   0.006907271704075, 0.002925595211138, 0.002197188681739, 0.000452281516461,
  -0.002074676531569,-0.004880554926214,-0.007287406595083,-0.008626885681949,
  -0.008438707861764, -0.00664543463053,-0.003605971257734,-7.003001109114e-05,
   0.003004023742881, 0.004714127170115, 0.004527928294312, 0.002416954361663,
  -0.001025016080829,-0.004755719392356,-0.007547054432133,-0.008362126927297,
  -0.006706500589346,-0.002833322602644, 0.002261173499396, 0.007076985020264,
     0.0100395249995, 0.009996958211723,  0.00663275197381,0.0006545486316751,
  -0.006301291859537, -0.01209710370032, -0.01469716804122, -0.01283486636479,
  -0.006506375256166, 0.002866788672598,  0.01268647658921,  0.01982757434994,
    0.02152968708423,  0.01629913477429, 0.004560546705341, -0.01115381572525,
   -0.02658182912986, -0.03663557930817,  -0.0366235254065, -0.02351767343094,
    0.00309084489565,  0.04059489366963,  0.08368155746993,   0.1253218016526,
     0.1582112331438,   0.1763457815685,   0.1763457815685,   0.1582112331438,
     0.1253218016526,  0.08368155746993,  0.04059489366963,  0.00309084489565,
   -0.02351767343094,  -0.0366235254065, -0.03663557930817, -0.02658182912986,
   -0.01115381572525, 0.004560546705341,  0.01629913477429,  0.02152968708423,
    0.01982757434994,  0.01268647658921, 0.002866788672598,-0.006506375256166,
   -0.01283486636479, -0.01469716804122, -0.01209710370032,-0.006301291859537,
  0.0006545486316751,  0.00663275197381, 0.009996958211723,   0.0100395249995,
   0.007076985020264, 0.002261173499396,-0.002833322602644,-0.006706500589346,
  -0.008362126927297,-0.007547054432133,-0.004755719392356,-0.001025016080829,
   0.002416954361663, 0.004527928294312, 0.004714127170115, 0.003004023742881,
  -7.003001109114e-05,-0.003605971257734, -0.00664543463053,-0.008438707861764,
  -0.008626885681949,-0.007287406595083,-0.004880554926214,-0.002074676531569,
   0.000452281516461, 0.002197188681739, 0.002925595211138, 0.006907271704075
};

int main(void)
{
    Pins_config();
    BIOS_start();
    return(0);
}

void przerwanie_rcv()
{
    probka = Read_mcasp1_rcv();
    x[n] = (short)probka;
    suma = 0;
    for (i = 0; i < BL; i++)
    {
        suma = suma + B[i] * x[(n-i)&Nmaska];
    }
    probka = roundf(suma);
    n++;
    n&=Nmaska;
    Write_mcasp1_xmt(probka);
    Restart_mcasp1_if_error();
}


void pierwszy_task(UArg arg1, UArg arg2)
{
    Config_i2c_and_codec();
    n = 0;
    Config_and_start_mcasp1();
    Hwi_enableInterrupt(13);
    while(1)
    {

    }
}
